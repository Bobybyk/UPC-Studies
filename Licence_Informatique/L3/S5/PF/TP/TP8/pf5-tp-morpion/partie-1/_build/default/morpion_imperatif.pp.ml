open Morpion_prelude open Morpion_debut open Morpion_victoire open Graphics let af1 co m d x y = let n = Matrix.size m in set_line_width 1; for i = 0 to n-1 do for j = 0 to n-1 do set_color co; draw_rect (i*50+x) (j*50+y) 50 50; moveto (i*50+x+15) (j*50+y); match Matrix.get m (i,j) with | None -> () | Some x -> set_color (if d = Some (i,j) then red else black); draw_string (string_of_int x); done done; set_color black; set_line_width 3; draw_rect x y (50*n) (50*n) let pos = function None -> None | Some x -> Some x.position let () = open_graph " 800x800"; (try set_font "-bitstream-*-*-r-normal-*-40-*-*-*-*-*-*-*" with _ -> try set_font "-*-fixed-medium-r-semicondensed-*-50-*-*-*-*-*-iso8859-1" with _ -> ()); let m = plateau_initial 3 in let d = ref None in while not (termine m) do af1 black m (pos !d) 50 50; let e = wait_next_event [Button_down] in let x = (e.mouse_x - 50) / 50 and y = (e.mouse_y - 50) / 50 in match prepare_coup m !d 2 (x,y) with | Some c when coup_legal m c -> Matrix.set m c.position (Some c.joueur); d := Some c | _ -> () done; af1 black m (pos !d) 50 50; set_color red; moveto 25 225; (match gagnant m with | None -> draw_string "Match nul !" | Some joueur -> draw_string ("Victoire du joueur " ^ string_of_int joueur ^ " !")); ignore (wait_next_event [Button_down ; Key_pressed]) 